import time
import json
import urllib.request
import urllib.parse
import urllib.error
from datetime import datetime

# ØªÙˆÚ©Ù† Ø±Ø¨Ø§Øª Ø´Ù…Ø§
TOKEN = "356132157:tSJcwKdGlZYk7Allppx1NGJ7JLc7PkMtFK3QETHx"
BASE_URL = f"https://tapi.bale.ai/bot{TOKEN}/"
CARD_NUMBER = "5022291530744570"  # Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ù…Ù‚ØµØ¯
SUPPORT_ID = "@ehsan1129"  # Ø¢ÛŒØ¯ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ

# Ú©Ø¯Ù‡Ø§ÛŒ Ù‡Ø¯ÛŒÙ‡ Ù…Ø¹ØªØ¨Ø±
GIFT_CODES = ["13831391", "85698569"]

# Ø¯ÛŒÚ©Ø´Ù†Ø±ÛŒ Ù‚ÛŒÙ…Øª Ùˆ Ù…Ø¯Øª Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ (Ø¨Ù‡ Ø±ÛŒØ§Ù„)
PACKAGES = {
    "Ø±ÙˆØ²Ø§Ù†Ù‡ - Û²Û° Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†": {
        "price": 200000,  # 20,000 ØªÙˆÙ…Ø§Ù† = 200,000 Ø±ÛŒØ§Ù„
        "duration": 1  # Ù…Ø¯Øª Ø¨Ù‡ Ø±ÙˆØ²
    },
    "Ù‡ÙØªÚ¯ÛŒ - Û±Û°Û° Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†": {
        "price": 1000000,  # 100,000 ØªÙˆÙ…Ø§Ù† = 1,000,000 Ø±ÛŒØ§Ù„
        "duration": 7  # Ù…Ø¯Øª Ø¨Ù‡ Ø±ÙˆØ²
    },
    "Ù…Ø§Ù‡Ø§Ù†Ù‡ - Û²Û°Û° Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†": {
        "price": 2000000,  # 200,000 ØªÙˆÙ…Ø§Ù† = 2,000,000 Ø±ÛŒØ§Ù„
        "duration": 30  # Ù…Ø¯Øª Ø¨Ù‡ Ø±ÙˆØ²
    },
    "Ù‡ÙØªÚ¯ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† - Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡": {
        "price": 0,
        "duration": 7  # Ù…Ø¯Øª Ø¨Ù‡ Ø±ÙˆØ²
    }
}

# Ø°Ø®ÛŒØ±Ù‡ ØªÙ…Ø§Ù… Ø³ÙˆØ§Ù„Ø§Øª Ùˆ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
archived_questions = []

# Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙˆÛŒÚ˜Ù‡ (Ú©Ø³Ø§Ù†ÛŒ Ú©Ù‡ Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡ 13831391 Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù‡â€ŒØ§Ù†Ø¯)
special_users = set()

# ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ ÙˆÛŒÚ˜Ù‡
remaining_program_requests = {}

# ØªÙˆØ§Ø¨Ø¹ Ø¯Ø±Ø®ÙˆØ§Ø³Øª
def get_updates(offset=None):
    url = BASE_URL + "getUpdates"
    params = {}
    if offset:
        params["offset"] = offset
    if params:
        url += "?" + urllib.parse.urlencode(params)
    
    try:
        request = urllib.request.Request(
            url,
            headers={"User-Agent": "Mozilla/5.0"},
            method="GET"
        )
        with urllib.request.urlopen(request, timeout=10) as response:
            return json.loads(response.read().decode('utf-8'))
    except Exception as e:
        print(f"Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡: {str(e)}")
        return {"ok": False, "result": []}


def send_message(chat_id, text, reply_markup=None):
    url = BASE_URL + "sendMessage"
    data = {
        "chat_id": chat_id,
        "text": text
    }
    if reply_markup:
        data["reply_markup"] = json.dumps(reply_markup)
    
    data_encoded = urllib.parse.urlencode(data).encode('utf-8')
    request = urllib.request.Request(
        url,
        data=data_encoded,
        headers={"Content-Type": "application/x-www-form-urlencoded"}
    )
    
    try:
        with urllib.request.urlopen(request, timeout=10) as response:
            # Ù„Ø§Ú¯ Ù¾ÛŒØ§Ù… Ø§Ø±Ø³Ø§Ù„ÛŒ
            print(f"ğŸ¤– Ø±Ø¨Ø§Øª: {text[:50]}{'...' if len(text) > 50 else ''}")
            return json.loads(response.read().decode('utf-8'))
    except Exception as e:
        print(f"Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…: {str(e)}")
        return None


def send_invoice(chat_id, title, description, payload, prices):
    """Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ø§Ø±Øª Ø¨Ù‡ Ú©Ø§Ø±Øª"""
    url = BASE_URL + "sendInvoice"
    data = {
        "chat_id": chat_id,
        "title": title,
        "description": description,
        "payload": payload,
        "provider_token": CARD_NUMBER,  # Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª Ù…Ù‚ØµØ¯
        "currency": "IRT",  # ØªÙˆÙ…Ø§Ù†
        "prices": json.dumps(prices),
        "need_name": False,
        "need_phone_number": False,
        "need_email": False,
        "need_shipping_address": False,
        "is_flexible": False,
        "provider_data": json.dumps({"type": "card"})  # Ù…Ø´Ø®Øµ Ú©Ø±Ø¯Ù† Ù†ÙˆØ¹ Ù¾Ø±Ø¯Ø§Ø®Øª
    }
    
    data_encoded = urllib.parse.urlencode(data).encode('utf-8')
    request = urllib.request.Request(
        url,
        data=data_encoded,
        headers={"Content-Type": "application/x-www-form-urlencoded"}
    )
    
    try:
        with urllib.request.urlopen(request, timeout=15) as response:
            print(f"ğŸ’³ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø±Ø§ÛŒ {title} Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯")
            return json.loads(response.read().decode('utf-8'))
    except urllib.error.HTTPError as e:
        # Ø¯Ø±ÛŒØ§ÙØª Ù…ØªÙ† Ø®Ø·Ø§ Ø¨Ø±Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ù…Ø´Ú©Ù„
        error_content = e.read().decode('utf-8')
        print(f"âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª: {e.code} {e.reason}")
        print(f"ğŸ“ Ù…Ø­ØªÙˆØ§ÛŒ Ø®Ø·Ø§: {error_content}")
        return None
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª: {str(e)}")
        return None


# Ù…Ù†ÙˆÙ‡Ø§
def get_main_menu(user_id, active_packages):
    """Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ ÙˆØ¶Ø¹ÛŒØª Ù¾Ú©ÛŒØ¬ Ú©Ø§Ø±Ø¨Ø±"""
    # Ø¨Ø±Ø±Ø³ÛŒ ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ù¾Ú©ÛŒØ¬
    active = False
    if user_id in active_packages:
        package = active_packages[user_id]
        if time.time() < package["expiry"]:
            active = True
        else:
            # Ø­Ø°Ù Ù¾Ú©ÛŒØ¬ Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡
            del active_packages[user_id]
            # Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… ØªÙ…Ø¯ÛŒØ¯
            send_message(
                package["chat_id"],
                "â³ Ù¾Ú©ÛŒØ¬ Ø´Ù…Ø§ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯.\n\n"
                "Ø§Ú¯Ø± Ø§Ø² Ø®Ø¯Ù…Ø§Øª Ù…Ø§ Ø±Ø§Ø¶ÛŒ Ø¨ÙˆØ¯ÛŒØ¯ØŒ Ø®ÙˆØ´Ø­Ø§Ù„ Ù…ÛŒâ€ŒØ´ÛŒÙ… ØªÙ…Ø¯ÛŒØ¯ Ú©Ù†ÛŒØ¯ ğŸ˜Š\n\n"
                "Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ù¾Ú©ÛŒØ¬ Ø¬Ø¯ÛŒØ¯ Ø§Ø² Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ Ú¯Ø²ÛŒÙ†Ù‡ 'Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ ğŸ’¼' Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯."
            )
    
    # Ø§ÛŒØ¬Ø§Ø¯ Ù…Ù†Ùˆ Ø¨Ø§ Ø§Ù…Ú©Ø§Ù† ÙˆÛŒÚ˜Ù‡ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø®Ø§Øµ
    keyboard = []
    
    if active:
        keyboard = [
            [{"text": "Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ ğŸ’¼"}],
            [{"text": "Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ğŸ‘¨â€ğŸ’¼"}, {"text": "Ø³ÙˆØ§Ù„ Ú©Ø±Ø¯Ù†! â“"}]
        ]
        
        # Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú¯Ø²ÛŒÙ†Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙˆÛŒÚ˜Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Ù‡ÙØªÚ¯ÛŒ Ùˆ Ù…Ø§Ù‡Ø§Ù†Ù‡
        package_type = active_packages[user_id]["type"]
        if "Ù‡ÙØªÚ¯ÛŒ" in package_type or "Ù…Ø§Ù‡Ø§Ù†Ù‡" in package_type:
            keyboard.append([{"text": "Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙˆÛŒÚ˜Ù‡ â­"}])
    else:
        keyboard = [
            [{"text": "Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ ğŸ’¼"}],
            [{"text": "Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ğŸ‘¨â€ğŸ’¼"}]
        ]
    
    # Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø®Ø§Øµ
    if user_id in special_users:
        keyboard.append([{"text": "Ø¨Ø§ÛŒÚ¯Ø§Ù†ÛŒ Ø³ÙˆØ§Ù„Ø§Øª ğŸ“‚"}])
        keyboard.append([{"text": "Ø§Ø±Ø³Ø§Ù„ Ø¬ÙˆØ§Ø¨ âœ‰ï¸"}])
    
    keyboard.append([{"text": "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ ğŸ "}])
    
    return {
        "keyboard": keyboard,
        "resize_keyboard": True
    }


PACKAGE_MENU = {
    "keyboard": [
        [{"text": "Ø±ÙˆØ²Ø§Ù†Ù‡ - Û²Û° Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†"}],
        [{"text": "Ù‡ÙØªÚ¯ÛŒ - Û±Û°Û° Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†"}],
        [{"text": "Ù…Ø§Ù‡Ø§Ù†Ù‡ - Û²Û°Û° Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†"}],
        [{"text": "Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡ ğŸ"}],
        [{"text": "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ ğŸ "}]
    ],
    "resize_keyboard": True
}

GIFT_CODE_MENU = {
    "keyboard": [
        [{"text": "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ ğŸ "}]
    ],
    "resize_keyboard": True
}

QUESTION_MENU = {
    "keyboard": [
        [{"text": "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ ğŸ "}]
    ],
    "resize_keyboard": True
}

PROGRAM_MENU = {
    "keyboard": [
        [{"text": "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ ğŸ "}]
    ],
    "resize_keyboard": True
}

ANSWER_USER_MENU = {
    "keyboard": [
        [{"text": "Ù„ØºÙˆ Ø¹Ù…Ù„ÛŒØ§Øª âŒ"}]
    ],
    "resize_keyboard": True
}


# Ø§Ø¬Ø±Ø§ÛŒ Ø±Ø¨Ø§Øª
def main():
    global archived_questions, special_users, remaining_program_requests
    
    print("ğŸ¤– Ø±Ø¨Ø§Øª Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§Ø³Øª...")
    last_update_id = 0
    user_states = {}  # Ø¨Ø±Ø§ÛŒ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
    active_packages = {}  # Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†: {user_id: {"expiry": Ø²Ù…Ø§Ù† Ø§Ù†Ù‚Ø¶Ø§, "type": Ù†ÙˆØ¹ Ù¾Ú©ÛŒØ¬, "chat_id": Ø¢ÛŒØ¯ÛŒ Ú†Øª}}
    premium_programs = {
        "Ø±ÙˆØ²Ø§Ù†Ù‡ - Û²Û° Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†": "Ù„ÛŒÙ†Ú© Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙˆÛŒÚ˜Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡",
        "Ù‡ÙØªÚ¯ÛŒ - Û±Û°Û° Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†": "Ù„ÛŒÙ†Ú© Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙˆÛŒÚ˜Ù‡ Ù‡ÙØªÚ¯ÛŒ",
        "Ù…Ø§Ù‡Ø§Ù†Ù‡ - Û²Û°Û° Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†": "Ù„ÛŒÙ†Ú© Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙˆÛŒÚ˜Ù‡ Ù…Ø§Ù‡Ø§Ù†Ù‡",
        "Ù‡ÙØªÚ¯ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† - Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡": "Ù„ÛŒÙ†Ú© Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙˆÛŒÚ˜Ù‡ Ù‡ÙØªÚ¯ÛŒ"
    }
    
    # Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ù…ÙˆÙ‚Øª Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒ
    answer_target_user = None
    answer_text = None

    while True:
        try:
            updates = get_updates(offset=last_update_id)
            
            if not updates.get("ok") or "result" not in updates:
                time.sleep(1)
                continue
                
            for update in updates.get("result", []):
                message = update.get("message", {})
                chat_id = message.get("chat", {}).get("id")
                text = message.get("text", "")
                update_id = update.get("update_id", 0)
                user_id = message.get("from", {}).get("id")
                first_name = message.get("from", {}).get("first_name", "")
                username = message.get('from', {}).get('username', 'N/A')
                successful_payment = message.get('successful_payment')

                if update_id > last_update_id:
                    last_update_id = update_id

                if not chat_id or not user_id:
                    continue
                
                # Ø¨Ø±Ø±Ø³ÛŒ Ø§Ù†Ù‚Ø¶Ø§ÛŒ Ù¾Ú©ÛŒØ¬
                if user_id in active_packages and time.time() >= active_packages[user_id]["expiry"]:
                    # Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø§Ù†Ù‚Ø¶Ø§
                    send_message(
                        chat_id,
                        "â³ Ù¾Ú©ÛŒØ¬ Ø´Ù…Ø§ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯.\n\n"
                        "Ø§Ú¯Ø± Ø§Ø² Ø®Ø¯Ù…Ø§Øª Ù…Ø§ Ø±Ø§Ø¶ÛŒ Ø¨ÙˆØ¯ÛŒØ¯ØŒ Ø®ÙˆØ´Ø­Ø§Ù„ Ù…ÛŒâ€ŒØ´ÛŒÙ… ØªÙ…Ø¯ÛŒØ¯ Ú©Ù†ÛŒØ¯ ğŸ˜Š\n\n"
                        "Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ù¾Ú©ÛŒØ¬ Ø¬Ø¯ÛŒØ¯ Ø§Ø² Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ Ú¯Ø²ÛŒÙ†Ù‡ 'Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ ğŸ’¼' Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯."
                    )
                    # Ø­Ø°Ù Ù¾Ú©ÛŒØ¬ Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡
                    del active_packages[user_id]
                    if user_id in remaining_program_requests:
                        del remaining_program_requests[user_id]
                
                # Ù„Ø§Ú¯ Ù¾ÛŒØ§Ù… Ø¯Ø±ÛŒØ§ÙØªÛŒ Ø§Ø² Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ø¢ÛŒØ¯ÛŒ Ø¨Ù„Ù‡
                if text:
                    if username != 'N/A':
                        print(f"ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø± (@{username}): {text}")
                    else:
                        print(f"ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø± (ID:{user_id}): {text}")

                # Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚
                if successful_payment:
                    amount_toman = successful_payment['total_amount']
                    
                    # Ù†Ù…Ø§ÛŒØ´ Ù„Ø§Ú¯ Ø¨Ø§ Ø¢ÛŒØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±
                    if username != 'N/A':
                        print(f"âœ… Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚ ØªÙˆØ³Ø· @{username}: {amount_toman} ØªÙˆÙ…Ø§Ù†")
                    else:
                        print(f"âœ… Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚ ØªÙˆØ³Ø· ID:{user_id}: {amount_toman} ØªÙˆÙ…Ø§Ù†")
                    
                    # ÛŒØ§ÙØªÙ† Ù†ÙˆØ¹ Ù¾Ú©ÛŒØ¬ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…Ø¨Ù„Øº
                    package_type = None
                    for pkg, details in PACKAGES.items():
                        if details["price"] == amount_toman:
                            package_type = pkg
                            break
                    
                    if package_type:
                        # Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø²Ù…Ø§Ù† Ø§Ù†Ù‚Ø¶Ø§
                        duration_days = PACKAGES[package_type]["duration"]
                        expiry = time.time() + (duration_days * 24 * 3600)
                        
                        # Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ú©ÛŒØ¬
                        active_packages[user_id] = {
                            "type": package_type,
                            "expiry": expiry,
                            "purchase_time": time.time(),
                            "chat_id": chat_id
                        }
                        
                        # ØªÙ†Ø¸ÛŒÙ… ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ
                        if "Ù…Ø§Ù‡Ø§Ù†Ù‡" in package_type:
                            remaining_program_requests[user_id] = 4
                        elif "Ù‡ÙØªÚ¯ÛŒ" in package_type:
                            remaining_program_requests[user_id] = 1
                        
                        # Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… ØªØ§ÛŒÛŒØ¯
                        expiry_date = time.strftime("%Y-%m-%d %H:%M", time.localtime(expiry))
                        message_text = (
                            f"âœ… Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!\n"
                            f"ğŸ“¦ Ù¾Ú©ÛŒØ¬: {package_type}\n"
                            f"â³ Ø§Ø¹ØªØ¨Ø§Ø± ØªØ§: {expiry_date}\n\n"
                            f"Ø§Ù…Ú©Ø§Ù†Ø§Øª ÙˆÛŒÚ˜Ù‡ Ø´Ù…Ø§ ÙØ¹Ø§Ù„ Ø´Ø¯:\n"
                            f"- Ø³ÙˆØ§Ù„ Ú©Ø±Ø¯Ù†! â“\n"
                        )
                        
                        # Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙˆÛŒÚ˜Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Ù‡ÙØªÚ¯ÛŒ Ùˆ Ù…Ø§Ù‡Ø§Ù†Ù‡
                        if "Ù‡ÙØªÚ¯ÛŒ" in package_type or "Ù…Ø§Ù‡Ø§Ù†Ù‡" in package_type:
                            message_text += f"- Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙˆÛŒÚ˜Ù‡ â­\n\n"
                            if "Ù…Ø§Ù‡Ø§Ù†Ù‡" in package_type:
                                message_text += f"ğŸ“Œ Ø´Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ØªØ§ Û´ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯"
                            elif "Ù‡ÙØªÚ¯ÛŒ" in package_type:
                                message_text += f"ğŸ“Œ Ø´Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Û± Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯"
                        
                        send_message(chat_id, message_text, get_main_menu(user_id, active_packages))
                    else:
                        send_message(chat_id, "âœ… Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯! Ø§Ù…Ø§ Ù¾Ú©ÛŒØ¬ Ù…Ø±ØªØ¨Ø· ÛŒØ§ÙØª Ù†Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.")
                    continue

                # Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¶Ø¹ÛŒØª Ù¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒ (Ù…Ø±Ø­Ù„Ù‡ 1: Ø¯Ø±ÛŒØ§ÙØª Ø¢ÛŒØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±)
                if user_id in user_states and user_states[user_id] == "answering_step1":
                    if text == "Ù„ØºÙˆ Ø¹Ù…Ù„ÛŒØ§Øª âŒ":
                        send_message(chat_id, "Ø¹Ù…Ù„ÛŒØ§Øª Ù„ØºÙˆ Ø´Ø¯.", get_main_menu(user_id, active_packages))
                        del user_states[user_id]
                    else:
                        # Ø°Ø®ÛŒØ±Ù‡ Ø¢ÛŒØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± Ù‡Ø¯Ù
                        user_states[user_id] = "answering_step2"
                        answer_target_user = text.strip()
                        send_message(
                            chat_id,
                            f"ğŸ‘¤ Ø¢ÛŒØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±: {answer_target_user}\n\n"
                            "Ù„Ø·ÙØ§Ù‹ Ù¾Ø§Ø³Ø® Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",
                            ANSWER_USER_MENU
                        )
                    continue
                
                # Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¶Ø¹ÛŒØª Ù¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒ (Ù…Ø±Ø­Ù„Ù‡ 2: Ø¯Ø±ÛŒØ§ÙØª Ù…ØªÙ† Ù¾Ø§Ø³Ø®)
                if user_id in user_states and user_states[user_id] == "answering_step2":
                    if text == "Ù„ØºÙˆ Ø¹Ù…Ù„ÛŒØ§Øª âŒ":
                        send_message(chat_id, "Ø¹Ù…Ù„ÛŒØ§Øª Ù„ØºÙˆ Ø´Ø¯.", get_main_menu(user_id, active_packages))
                        del user_states[user_id]
                    else:
                        # Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
                        try:
                            target_id = int(answer_target_user)
                            send_message(
                                target_id,
                                f"ğŸ“¬ Ù¾Ø§Ø³Ø® Ø§Ø² Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ:\n\n{text}"
                            )
                            send_message(
                                chat_id,
                                f"âœ… Ù¾Ø§Ø³Ø® Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± {answer_target_user} Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.",
                                get_main_menu(user_id, active_packages)
                            )
                            
                            # Ù†Ù…Ø§ÛŒØ´ Ù„Ø§Ú¯ Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®
                            print(f"âœ‰ï¸ Ù¾Ø§Ø³Ø® Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯Ù‡ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± {answer_target_user}: {text[:30]}...")
                        except:
                            send_message(
                                chat_id,
                                "âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®! Ù„Ø·ÙØ§Ù‹ Ø¢ÛŒØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¹Ø¯Ø¯ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.",
                                get_main_menu(user_id, active_packages)
                            )
                        finally:
                            del user_states[user_id]
                    continue

                # Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø± (Ø§Ú¯Ø± Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø³ÛŒØ¯Ù† Ø³ÙˆØ§Ù„ Ø§Ø³Øª)
                if user_id in user_states and user_states[user_id] == "asking_question":
                    if text == "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ ğŸ ":
                        send_message(chat_id, "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ ğŸ ", get_main_menu(user_id, active_packages))
                        del user_states[user_id]
                    else:
                        # Ù†Ù…Ø§ÛŒØ´ Ù„Ø§Ú¯ Ø³ÙˆØ§Ù„ Ø¨Ø§ Ø¢ÛŒØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±
                        if username != 'N/A':
                            print(f"â“ Ø³ÙˆØ§Ù„ Ø§Ø² @{username}: {text}")
                        else:
                            print(f"â“ Ø³ÙˆØ§Ù„ Ø§Ø² ID:{user_id}: {text}")
                        
                        # Ø§Ø¹Ù„Ø§Ù… Ø¯Ø±ÛŒØ§ÙØª Ø³ÙˆØ§Ù„ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±
                        send_message(
                            chat_id, 
                            "âœ… Ø³ÙˆØ§Ù„ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¯Ø±ÛŒØ§ÙØª Ùˆ Ø«Ø¨Øª Ø´Ø¯.\n"
                            "Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÙ‡Ø§ Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ù¾Ø§Ø³Ø® Ø´Ù…Ø§ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ø®ÙˆØ§Ù‡Ù†Ø¯ Ú©Ø±Ø¯.",
                            QUESTION_MENU
                        )
                        
                        # Ø°Ø®ÛŒØ±Ù‡ Ø³ÙˆØ§Ù„ Ø¯Ø± Ø¨Ø§ÛŒÚ¯Ø§Ù†ÛŒ
                        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
                        archived_questions.append({
                            "user_id": user_id,
                            "username": username if username != 'N/A' else None,
                            "question": text,
                            "timestamp": timestamp,
                            "type": "Ø³ÙˆØ§Ù„"
                        })
                    continue
                
                # Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙˆÛŒÚ˜Ù‡
                if user_id in user_states and user_states[user_id] == "program_request":
                    if text == "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ ğŸ ":
                        send_message(chat_id, "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ ğŸ ", get_main_menu(user_id, active_packages))
                        del user_states[user_id]
                    else:
                        # Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¹ØªØ¨Ø§Ø± Ù¾Ú©ÛŒØ¬ Ùˆ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
                        if user_id in active_packages and time.time() < active_packages[user_id]["expiry"]:
                            package_type = active_packages[user_id]["type"]
                            
                            # Ú©Ø³Ø± ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§
                            if user_id in remaining_program_requests and remaining_program_requests[user_id] > 0:
                                remaining_program_requests[user_id] -= 1
                                
                                # Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø± Ø¨Ø§ÛŒÚ¯Ø§Ù†ÛŒ
                                timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
                                archived_questions.append({
                                    "user_id": user_id,
                                    "username": username if username != 'N/A' else None,
                                    "question": text,
                                    "timestamp": timestamp,
                                    "type": "Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙˆÛŒÚ˜Ù‡"
                                })
                                
                                # Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… ØªØ£ÛŒÛŒØ¯
                                send_message(
                                    chat_id,
                                    "âœ… Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙˆÛŒÚ˜Ù‡ Ø´Ù…Ø§ Ø«Ø¨Øª Ø´Ø¯.\n\n"
                                    "Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒ Ø´Ù…Ø§ Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.\n\n"
                                    f"ğŸ“ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡: {remaining_program_requests[user_id]}",
                                    get_main_menu(user_id, active_packages)
                                )
                                
                                # Ù†Ù…Ø§ÛŒØ´ Ù„Ø§Ú¯
                                print(f"ğŸŒŸ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙˆÛŒÚ˜Ù‡ Ø§Ø² Ú©Ø§Ø±Ø¨Ø± {user_id}: {text[:50]}...")
                            else:
                                send_message(
                                    chat_id,
                                    "â›”ï¸ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙˆÛŒÚ˜Ù‡ Ø´Ù…Ø§ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯Ù‡ Ø§Ø³Øª.",
                                    get_main_menu(user_id, active_packages)
                                )
                        else:
                            send_message(chat_id, "âš ï¸ Ù¾Ú©ÛŒØ¬ Ø´Ù…Ø§ Ù…Ù†Ù‚Ø¶ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.", get_main_menu(user_id, active_packages))
                        
                        del user_states[user_id]
                    continue
                    
                # Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ø±Ø¨Ø± (Ø§Ú¯Ø± Ø¯Ø± Ø­Ø§Ù„ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡ Ø§Ø³Øª)
                if user_id in user_states and user_states[user_id] == "entering_gift_code":
                    if text == "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ ğŸ ":
                        send_message(chat_id, "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ ğŸ ", get_main_menu(user_id, active_packages))
                        del user_states[user_id]
                    else:
                        # Ù†Ù…Ø§ÛŒØ´ Ù„Ø§Ú¯ Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡ Ø¨Ø§ Ø¢ÛŒØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±
                        if username != 'N/A':
                            print(f"ğŸ Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡ Ø§Ø² @{username}: {text}")
                        else:
                            print(f"ğŸ Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡ Ø§Ø² ID:{user_id}: {text}")
                        
                        # Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡
                        if text in GIFT_CODES:
                            # ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù¾Ú©ÛŒØ¬ Ù‡ÙØªÚ¯ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù†
                            package_type = "Ù‡ÙØªÚ¯ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† - Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡"
                            duration_days = PACKAGES[package_type]["duration"]
                            expiry = time.time() + (duration_days * 24 * 3600)
                            
                            # Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ú©ÛŒØ¬
                            active_packages[user_id] = {
                                "type": package_type,
                                "expiry": expiry,
                                "purchase_time": time.time(),
                                "chat_id": chat_id
                            }
                            
                            # ØªÙ†Ø¸ÛŒÙ… ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ
                            remaining_program_requests[user_id] = 1
                            
                            # Ø§Ú¯Ø± Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡ ÙˆÛŒÚ˜Ù‡ Ø¨ÙˆØ¯ØŒ Ú©Ø§Ø±Ø¨Ø± Ø±Ø§ Ø¨Ù‡ Ù„ÛŒØ³Øª ÙˆÛŒÚ˜Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
                            if text == "13831391":
                                special_users.add(user_id)
                                print(f"ğŸŒŸ Ú©Ø§Ø±Ø¨Ø± ÙˆÛŒÚ˜Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯: {user_id}")
                            
                            # Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… ØªØ¨Ø±ÛŒÚ©
                            expiry_date = time.strftime("%Y-%m-%d %H:%M", time.localtime(expiry))
                            message_text = (
                                f"ğŸ‰ ØªØ¨Ø±ÛŒÚ©! Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡ Ø´Ù…Ø§ Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª!\n\n"
                                f"ğŸ Ù¾Ú©ÛŒØ¬ Ù‡ÙØªÚ¯ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ ÙØ¹Ø§Ù„ Ø´Ø¯\n"
                                f"ğŸ“¦ Ù¾Ú©ÛŒØ¬: {package_type}\n"
                                f"â³ Ø§Ø¹ØªØ¨Ø§Ø± ØªØ§: {expiry_date}\n\n"
                                f"Ø§Ù…Ú©Ø§Ù†Ø§Øª ÙˆÛŒÚ˜Ù‡ Ø´Ù…Ø§ ÙØ¹Ø§Ù„ Ø´Ø¯:\n"
                                f"- Ø³ÙˆØ§Ù„ Ú©Ø±Ø¯Ù†! â“\n"
                                f"- Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙˆÛŒÚ˜Ù‡ â­\n\n"
                                f"ğŸ“Œ Ø´Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Û± Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯"
                            )
                            send_message(chat_id, message_text, get_main_menu(user_id, active_packages))
                            
                            # Ù†Ù…Ø§ÛŒØ´ Ù„Ø§Ú¯ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Ø¢ÛŒØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø±
                            if username != 'N/A':
                                print(f"ğŸ‰ Ù¾Ú©ÛŒØ¬ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø¨Ø±Ø§ÛŒ @{username} ÙØ¹Ø§Ù„ Ø´Ø¯")
                            else:
                                print(f"ğŸ‰ Ù¾Ú©ÛŒØ¬ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø¨Ø±Ø§ÛŒ ID:{user_id} ÙØ¹Ø§Ù„ Ø´Ø¯")
                        else:
                            send_message(chat_id, "âŒ Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.", GIFT_CODE_MENU)
                        del user_states[user_id]
                    continue

                # Ø¯Ø³ØªÙˆØ±Ø§Øª Ø§ØµÙ„ÛŒ
                if text == "/start":
                    # Ù¾ÛŒØ§Ù… ØªØ¨Ù„ÛŒØºØ§ØªÛŒ Ùˆ Ù…Ø¹Ø±ÙÛŒ
                    promo_message = (
                        "ğŸŒŸ **Ø¨Ù‡ Ø±Ø¨Ø§Øª Ù…Ø´Ø§ÙˆØ±Ù‡â€ŒØ§ÛŒ Ù†Ø®Ø¨Ú¯Ø§Ù† Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯!** ğŸŒŸ\n\n"
                        "Ù…Ø§ Ø¨Ø§ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¨Ù‡ Ø´Ù…Ø§ Ù‚ÙˆÙ„ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ… Ú©Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø§ØŒ ØªØ¶Ù…ÛŒÙ†ÛŒ Ø¨Ø±Ø§ÛŒ Ù…ÙˆÙÙ‚ÛŒØª Ø´Ù…Ø§Ø³Øª! ğŸ’¯\n\n"
                        "âœ… **Ú†Ø±Ø§ Ù…Ø§ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ØŸ**\n"
                        "- Ù…Ø´Ø§ÙˆØ±Ø§Ù† Ù…Ø§ Ù‡Ù…Ú¯ÛŒ Ø§Ø² **Ø±ØªØ¨Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø±ØªØ± Ú©Ù†Ú©ÙˆØ±** Ù‡Ø³ØªÙ†Ø¯\n"
                        "- Ø¯Ø§Ø±Ø§ÛŒ **Ø³Ø§Ø¨Ù‚Ù‡ Ø¯Ø±Ø®Ø´Ø§Ù†** Ùˆ **ØªØ®ØµØµ Ø¨Ø§Ù„Ø§** Ø¯Ø± Ø²Ù…ÛŒÙ†Ù‡ Ù…Ø´Ø§ÙˆØ±Ù‡\n"
                        "- **ØªØ¶Ù…ÛŒÙ† Ú©ÛŒÙÛŒØª** Ø®Ø¯Ù…Ø§Øª Ø¨Ø§ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Û²Û´ Ø³Ø§Ø¹ØªÙ‡\n\n"
                        "ğŸ’ **Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªØ«Ù†Ø§ÛŒÛŒ Ø¨Ø§ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§ÙˆØ±Ù†Ú©Ø±Ø¯Ù†ÛŒ:**\n"
                        "â–«ï¸ Ù¾Ú©ÛŒØ¬ Ø±ÙˆØ²Ø§Ù†Ù‡ - ÙÙ‚Ø· Û²Û° Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†\n"
                        "â–«ï¸ Ù¾Ú©ÛŒØ¬ Ù‡ÙØªÚ¯ÛŒ - ÙÙ‚Ø· Û±Û°Û° Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†\n"
                        "â–«ï¸ Ù¾Ú©ÛŒØ¬ Ù…Ø§Ù‡Ø§Ù†Ù‡ - ÙÙ‚Ø· Û²Û°Û° Ù‡Ø²Ø§Ø± ØªÙˆÙ…Ø§Ù†\n\n"
                        "ğŸ”¥ Ø§ÛŒÙ† Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ø¯Ø± Ù…Ù‚Ø§Ø¨Ù„ Ø®Ø¯Ù…Ø§Øª Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ù…Ø§ **Ù†Ø§Ú†ÛŒØ²** Ø§Ø³Øª!\n"
                        "Ø´Ù…Ø§ Ù‡ÛŒÚ†â€ŒØ¬Ø§ Ú†Ù†ÛŒÙ† Ø®Ø¯Ù…Ø§Øª Ø¨Ø§Ú©ÛŒÙÛŒØªÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø³ØªØ«Ù†Ø§ÛŒÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø®ÙˆØ§Ù‡ÛŒØ¯ Ú©Ø±Ø¯!\n\n"
                        "Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ù…Ø³ÛŒØ± Ù…ÙˆÙÙ‚ÛŒØªØŒ Ù‡Ù…ÛŒÙ† Ø§Ù„Ø§Ù† ÛŒÚ©ÛŒ Ø§Ø² Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:"
                    )
                    send_message(chat_id, promo_message, get_main_menu(user_id, active_packages))
                elif text == "Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ ğŸ‘¨â€ğŸ’¼":
                    send_message(chat_id, f"Ø¨Ø±Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ Ø¢ÛŒØ¯ÛŒ Ø²ÛŒØ± ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯:\nğŸ‘¨â€ğŸ’¼ {SUPPORT_ID}")
                elif text == "Ø³ÙˆØ§Ù„ Ú©Ø±Ø¯Ù†! â“":
                    # Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¹ØªØ¨Ø§Ø± Ù¾Ú©ÛŒØ¬
                    if user_id in active_packages and time.time() < active_packages[user_id]["expiry"]:
                        user_states[user_id] = "asking_question"
                        send_message(
                            chat_id, 
                            "Ù„Ø·ÙØ§Ù‹ Ø³ÙˆØ§Ù„ Ø®ÙˆØ¯ Ø±Ø§ ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯:",
                            QUESTION_MENU
                        )
                    else:
                        send_message(chat_id, "âš ï¸ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØªØŒ Ø¨Ø§ÛŒØ¯ Ù¾Ú©ÛŒØ¬ ÙØ¹Ø§Ù„ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯.")
                elif text == "Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙˆÛŒÚ˜Ù‡ â­":
                    # Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¹ØªØ¨Ø§Ø± Ù¾Ú©ÛŒØ¬
                    if user_id in active_packages and time.time() < active_packages[user_id]["expiry"]:
                        package_type = active_packages[user_id]["type"]
                        
                        # Ø¨Ø±Ø±Ø³ÛŒ Ù†ÙˆØ¹ Ù¾Ú©ÛŒØ¬
                        if "Ù‡ÙØªÚ¯ÛŒ" in package_type or "Ù…Ø§Ù‡Ø§Ù†Ù‡" in package_type:
                            # Ø¨Ø±Ø±Ø³ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡
                            if user_id in remaining_program_requests and remaining_program_requests[user_id] > 0:
                                user_states[user_id] = "program_request"
                                send_message(
                                    chat_id,
                                    "ğŸ“ Ù„Ø·ÙØ§Ù‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²ÛŒØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:\n\n"
                                    "1. Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù‡ÙØªÙ‡ Ùˆ Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ Ø®ÙˆØ¯\n"
                                    "2. Ù…Ø´ØºÙ„Ù‡â€ŒÙ‡Ø§ÛŒ Ø«Ø§Ø¨Øª (Ú©Ø§Ø±ØŒ Ú©Ù„Ø§Ø³ØŒ ...)\n"
                                    "3. Ø¯Ø±ÙˆØ³ ÛŒØ§ Ù…ÙˆØ¶ÙˆØ¹Ø§ØªÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ù…Ø·Ø§Ù„Ø¹Ù‡ Ú©Ù†ÛŒØ¯\n"
                                    "4. Ø§Ù‡Ø¯Ø§Ù Ùˆ Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§\n\n"
                                    "Ù…Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§ÛŒÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÛŒÚ© Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒ Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ø¢Ù…Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ….",
                                    PROGRAM_MENU
                                )
                            else:
                                send_message(
                                    chat_id,
                                    "â›”ï¸ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙˆÛŒÚ˜Ù‡ Ø´Ù…Ø§ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯Ù‡ Ø§Ø³Øª.",
                                    get_main_menu(user_id, active_packages)
                                )
                        else:
                            send_message(chat_id, "âš ï¸ Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Ù‡ÙØªÚ¯ÛŒ Ùˆ Ù…Ø§Ù‡Ø§Ù†Ù‡ ÙØ¹Ø§Ù„ Ø§Ø³Øª.")
                    else:
                        send_message(chat_id, "âš ï¸ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØªØŒ Ø¨Ø§ÛŒØ¯ Ù¾Ú©ÛŒØ¬ ÙØ¹Ø§Ù„ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯.")
                elif text == "Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ ğŸ’¼":
                    send_message(chat_id, "Ù„Ø·ÙØ§Ù‹ ÛŒÚ©ÛŒ Ø§Ø² Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:", PACKAGE_MENU)
                elif text in PACKAGES:
                    # Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª
                    amount = PACKAGES[text]["price"]
                    package_name = text.split("-")[0].strip()
                    
                    # Ø§ÛŒØ¬Ø§Ø¯ Ø´Ù†Ø§Ø³Ù‡ ÛŒÚ©ØªØ§ Ø¨Ø±Ø§ÛŒ ØªØ±Ø§Ú©Ù†Ø´
                    transaction_id = f"{user_id}_{int(time.time())}"
                    
                    # Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø·ÙˆÙ„ Ø¹Ù†ÙˆØ§Ù† Ùˆ ØªÙˆØ¶ÛŒØ­Ø§Øª
                    title = f"Ù¾Ú©ÛŒØ¬ {package_name}"[:32]
                    
                    # ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¨Ø§ Ù…ØªÙ† Ø§Ø·Ù…ÛŒÙ†Ø§Ù†â€ŒØ¨Ø®Ø´ (Ú©ÙˆØªØ§Ù‡â€ŒØªØ±)
                    description = (
                        "Ø®Ø±ÛŒØ¯ Ù¾Ú©ÛŒØ¬ - Ø®ÛŒØ§Ù„ØªÙˆÙ† Ø±Ø§Ø­ØªØŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³Ø§Ø²Ù†Ø¯Ù‡ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ø¨Ù„Ù‡ Ø§Ø³Øª. "
                        "Ø¯Ø± ØµÙˆØ±Øª Ù†Ø§Ø±Ø¶Ø§ÛŒØªÛŒØŒ Ù‡Ø²ÛŒÙ†Ù‡ Ø¨Ø±Ú¯Ø´Øª Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯."
                    )[:255]
                    
                    # Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø¯ÙˆÙ† ØªØµÙˆÛŒØ±
                    print(f"ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø±Ø§ÛŒ {title}...")
                    print(f"ğŸ“¦ Ù¾Ú©ÛŒØ¬: {text}")
                    print(f"ğŸ’° Ù…Ø¨Ù„Øº: {amount} Ø±ÛŒØ§Ù„")
                    
                    result = send_invoice(
                        chat_id=chat_id,
                        title=title,
                        description=description,
                        payload=transaction_id,
                        prices=[{"label": text, "amount": amount}]
                    )
                    
                    if result is None:
                        print("âŒ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯")
                        send_message(
                            chat_id,
                            "âš ï¸ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø¢Ù…Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯."
                        )
                elif text == "Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡ ğŸ":
                    user_states[user_id] = "entering_gift_code"
                    send_message(
                        chat_id,
                        "ğŸ Ù„Ø·ÙØ§Ù‹ Ú©Ø¯ Ù‡Ø¯ÛŒÙ‡ Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:\n\n"
                        "Ù¾Ø³ Ø§Ø² ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ú©Ø¯ØŒ Ù¾Ú©ÛŒØ¬ Ù‡ÙØªÚ¯ÛŒ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ ÙØ¹Ø§Ù„ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.",
                        GIFT_CODE_MENU
                    )
                elif text == "Ø¨Ø§ÛŒÚ¯Ø§Ù†ÛŒ Ø³ÙˆØ§Ù„Ø§Øª ğŸ“‚":
                    # ÙÙ‚Ø· Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙˆÛŒÚ˜Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ø¨Ø§ÛŒÚ¯Ø§Ù†ÛŒ Ø±Ø§ Ø¨Ø¨ÛŒÙ†Ù†Ø¯
                    if user_id in special_users:
                        if not archived_questions:
                            send_message(chat_id, "Ù‡Ù†ÙˆØ² Ù‡ÛŒÚ† Ø³ÙˆØ§Ù„ÛŒ Ø¯Ø± Ø¨Ø§ÛŒÚ¯Ø§Ù†ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.")
                        else:
                            # Ø³Ø§Ø®Øª Ù…ØªÙ† Ø¨Ø§ÛŒÚ¯Ø§Ù†ÛŒ
                            archive_text = "ğŸ“‚ Ø¨Ø§ÛŒÚ¯Ø§Ù†ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ùˆ Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§:\n\n"
                            for idx, question in enumerate(archived_questions, 1):
                                # Ù†Ù…Ø§ÛŒØ´ Ù‡Ù… Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ Ùˆ Ù‡Ù… Ø¢ÛŒØ¯ÛŒ Ø¨Ù„Ù‡
                                user_info = f"ğŸ‘¤ Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ: {question['user_id']}"
                                if question['username']:
                                    user_info += f" | Ø¢ÛŒØ¯ÛŒ Ø¨Ù„Ù‡: @{question['username']}"
                                
                                # ØªØ¹ÛŒÛŒÙ† Ù†ÙˆØ¹ Ù…Ø­ØªÙˆØ§
                                content_type = "Ø³ÙˆØ§Ù„" if question['type'] == "Ø³ÙˆØ§Ù„" else "Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ø±Ù†Ø§Ù…Ù‡ ÙˆÛŒÚ˜Ù‡"
                                
                                archive_text += (
                                    f"{idx}. {user_info}\n"
                                    f"â° Ø²Ù…Ø§Ù†: {question['timestamp']}\n"
                                    f"ğŸ“ Ù†ÙˆØ¹: {content_type}\n"
                                    f"ğŸ’¬ Ù…Ø­ØªÙˆØ§: {question['question']}\n\n"
                                )
                            
                            # Ø§Ø±Ø³Ø§Ù„ Ø¨Ø§ÛŒÚ¯Ø§Ù†ÛŒ
                            send_message(chat_id, archive_text)
                    else:
                        send_message(chat_id, "â›”ï¸ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø¨Ø§ÛŒÚ¯Ø§Ù†ÛŒ Ø³ÙˆØ§Ù„Ø§Øª Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª.")
                elif text == "Ø§Ø±Ø³Ø§Ù„ Ø¬ÙˆØ§Ø¨ âœ‰ï¸":
                    # ÙÙ‚Ø· Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙˆÛŒÚ˜Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ù¾Ø§Ø³Ø® Ø§Ø±Ø³Ø§Ù„ Ú©Ù†Ù†Ø¯
                    if user_id in special_users:
                        user_states[user_id] = "answering_step1"
                        send_message(
                            chat_id,
                            "Ù„Ø·ÙØ§Ù‹ Ø¢ÛŒØ¯ÛŒ Ø¹Ø¯Ø¯ÛŒ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø¨Ù‡ Ø§Ùˆ Ù¾Ø§Ø³Ø® Ø¯Ù‡ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:",
                            ANSWER_USER_MENU
                        )
                    else:
                        send_message(chat_id, "â›”ï¸ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª.")
                elif text == "Ù„ØºÙˆ Ø¹Ù…Ù„ÛŒØ§Øª âŒ":
                    if user_id in user_states:
                        del user_states[user_id]
                    send_message(chat_id, "Ø¹Ù…Ù„ÛŒØ§Øª Ù„ØºÙˆ Ø´Ø¯.", get_main_menu(user_id, active_packages))
                elif text == "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ ğŸ ":
                    if user_id in user_states:
                        del user_states[user_id]
                    send_message(chat_id, "Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ ğŸ ", get_main_menu(user_id, active_packages))
                else:
                    send_message(chat_id, "Ù„Ø·ÙØ§Ù‹ ÙÙ‚Ø· Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.", get_main_menu(user_id, active_packages))

            # Ø§ÙØ²Ø§ÛŒØ´ Ø¢Ù¾Ø¯ÛŒØª Ø¢ÛŒØ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø¨Ø¹Ø¯ÛŒ
            if updates["result"]:
                last_update_id = max(update["update_id"] for update in updates["result"]) + 1

        except Exception as e:
            print(f"Ø®Ø·Ø§ Ø¯Ø± Ø­Ù„Ù‚Ù‡ Ø§ØµÙ„ÛŒ: {str(e)}")
            time.sleep(5)
        
        time.sleep(1)


if __name__ == "__main__":
    main()
